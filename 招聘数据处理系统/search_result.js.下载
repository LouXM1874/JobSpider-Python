$(document).ready(function() {

    $(window).scroll(function(){
        var offsetTop = 0;
        if($('.dw_tlc').eq(0).hasClass('fix')){
            offsetTop = $('#dw_tlc_mk').offset().top;
        }else{
            offsetTop = $('.dw_tlc').eq(0).offset().top;
        }

        if($(this).scrollTop() > offsetTop){
            $('#dw_tlc_mk').height($('.dw_tlc').eq(0).height()+2);
            $('.dw_tlc').eq(0).addClass('fix');
            $("[event-type='13']").attr('event-type', 18);
            $("[event-type='14']").attr('event-type', 19);
        }else{
            $('#dw_tlc_mk').height(0);
            $('.dw_tlc').eq(0).removeClass('fix');
            $("[event-type='18']").attr('event-type', 13);
            $("[event-type='19']").attr('event-type', 14);
        }
    });

    $('.dw_filter .el .more').click(function(){//展示更多选项
        var $parent = $(this).parents('.el');
        if($parent.hasClass('on')){
            $parent.removeClass('on');
        }else{
            $parent.addClass('on');
        }
    });
    
    function searchInit() {
        if ( window.Search ) {
            clearInterval( intVal );
            window.zzSearch = new Search( {
                searchForm : document.searchForm ,
                pageForm : document.pageForm ,
                excludeForm : document.excludeForm ,
                pageJumpForm : document.pageJumpForm ,
                selJobPageForm : document.selJobPageForm ,
                cfg : cfg
            } );
            zzSearch.searchForm.onsubmit = function() { zzSearch.formSub( this ); return false; };
            zzSearch.initKwdInputEvt();
            if (window.cfg.fileName == 'search_result.php') {
                zzSearch.initExcludeSearch();
            }
        }
    }
    var intVal = window.setInterval(searchInit , 50);
    
    //搜索广告展示埋点
    if($("#search_company_ad").length > 0){
        var trackChangeParams = {
            cusParam: "1" + String.fromCharCode(22) + trackConfig.accountid + String.fromCharCode(22) + $.trim($("#kwdselectid").val()) + String.fromCharCode(22) + ($("#jobarea").val() == "000000" ? "" : $("#jobarea").val()) + String.fromCharCode(22) + $("#coad_companyid").val()
        };
        manualTrack("adShowManualTrack", trackChangeParams);
    }
	//名企关闭按钮
	$('.com_close').click(function(){
		$('.company').hide()
	})
});

$(document).mouseup(function() {
    $('.tSearch_select_list').find('.intPopbox').hide();
});


function collapseExpansionJobareaLine(id, element) {
    var config = {
        'show': {
            'add': 'show_line',
            'remove': 'hide_line',
            'html': '收起'
        },
        'hide': {
            'add': 'hide_line',
            'remove': 'show_line',
            'html': '更多'
        }
    }

    if ($('#' + id).hasClass(config.show.add)) {
        $('#' + id).addClass(config.hide.add);
        $('#' + id).removeClass(config.hide.remove);
        $(element).html(config.hide.html);
    } else {
        $('#' + id).addClass(config.show.add);
        $('#' + id).removeClass(config.show.remove);
        $(element).html(config.show.html);
    }
}


function showLine(DOMAIN_SEARCH, lineNum, element) {

    var urlEncode = window.encodeURIComponent || window.escape;


    if (0 == $('#station_' + lineNum).length) {
        var list = {
            'jobarea': '',
            'district': '',
            'funtype': '',
            'industrytype': '',
            'issuedate': '',
            'providesalary': '',
            'keyword': '',
            'keywordtype': '',
            'postchannel': '',
            'workyear': '',
            'cotype': '',
            'degreefrom': '',
            'jobterm': '',
            'companysize': '',
            'address': '',
            'line': '',
            'ord_field': '',
            'from': '',
            'line_now': '',//当前line,用与get_line.php判断
            'welfare': ''
        };

        $.each(list, function (i, value) {
            var formValue = $('[name="pageForm"] [name="' + i + '"]').val();

            switch (i) {
                case 'jobarea':
                    var formAreaList = jobarea = '';
                    if (-1 != formValue.indexOf(',')) {
                        formAreaList = formValue.split(',');
                        jobarea      = formAreaList[0];
                    } else {
                        jobarea      = formValue;
                    }

                    list[i] = jobarea;
                    break;

                case 'line':
                    list[i] = $(element).html();
                    break;

                case 'line_now':
                    list[i] = $('[name="pageForm"] [name="line"]').val();
                    break;

                default:
                    list[i] = formValue;
                    break;
            }
        });

        var actionUrl = DOMAIN_SEARCH + '/jobsearch/ajax/get_line.php?rand='+ Math.random() + '&jsoncallback=?';

        $.getJSON(actionUrl, list, function (data) {
            if ('' != data.data) {
                $('.nk').hide();
                $(element).addClass('dw_c_orange');

                $.each($(element).siblings(), function () {
                    $(this).removeClass('dw_c_orange');
                });

                $('#filter_p_line').after(data.data);
            }
        });
    }


    if ($('#station_' + lineNum).is(':hidden')) {
        $.each($('.nk'), function () {
            $(this).hide();
        });
        $('#station_' + lineNum).show();
        $(element).addClass('dw_c_orange');

        $.each($(element).siblings(), function () {
            $(this).removeClass('dw_c_orange');
        });
    }
}

function showDibiao(DOMAIN_SEARCH, districtNum, element) {

    var urlEncode = window.encodeURIComponent || window.escape;

    if (0 == $('#hotdibiao_' + $('[name="pageForm"] [name="jobarea"]').val().substr(0, 6) + '_' + districtNum).length) {
        var list = {
            'jobarea': '',
            'district': '',
            'funtype': '',
            'industrytype': '',
            'issuedate': '',
            'providesalary': '',
            'keyword': '',
            'keywordtype': '',
            'postchannel': '',
            'workyear': '',
            'cotype': '',
            'degreefrom': '',
            'jobterm': '',
            'companysize': '',
            'address': '',
            'line': '',
            'ord_field': '',
            'dibiaoid': '',
            'from': '',
            'district_now': '',//用于判断当前地标是否是热门地标
            'welfare': ''
        };

        $.each(list, function (i, value) {
            var formValue = $('[name="pageForm"] [name="' + i + '"]').val();

            switch (i) {
                case 'jobarea':
                    var formAreaList = jobarea = '';
                    if (-1 != formValue.indexOf(',')) {
                        formAreaList = formValue.split(',');
                        jobarea      = formAreaList[0];
                    } else {
                        jobarea      = formValue;
                    }

                    list[i] = jobarea;
                    break;

                case 'district':
                    list[i] = districtNum;
                    break;

                case 'district_now':
                    list[i] = $('[name=pageForm] [name=district]').val();
                    break;
                default:
                    list[i] = formValue;
                    break;
            }
        });

        var actionUrl = DOMAIN_SEARCH + '/jobsearch/ajax/get_districtdibiao.php?rand='+ Math.random() + '&jsoncallback=?';

        $.getJSON(actionUrl, list, function (data) {
            if ('' != data.data) {
                $('.nk').hide();
                $(element).addClass('dw_c_orange');

                $.each($(element).siblings(), function () {
                    $(this).removeClass('dw_c_orange');
                });

                $('#filter_p_line').after(data.data);
            }
        });
    }

    $.each($('.nk'), function () {
        $(this).hide();
    });

    $(element).addClass('dw_c_orange');
    $.each($(element).siblings(), function () {
        $(this).removeClass('dw_c_orange');
    });
    $('#hotdibiao_' + $('[name="pageForm"] [name="jobarea"]').val().substr(0, 6) + '_' + districtNum).show();
}


function collapseExpansion(DOMAIN_SEARCH, type, collapse) {
    $.ajax({
        type:"get",
        cache:false,
        url:DOMAIN_SEARCH + '/jobsearch/ajax/collapse_expansion.php?collapse=' + collapse + '&type='+ type + '&ran=' + Math.random()
    });
}

function showHotdibiaoid(element) {
    $('.nk').hide();
    $('#filter_p_dibiaoid').show();
    $.each($(element).siblings(), function () {
        $(this).removeClass('dw_c_orange');
    });
    $(element).addClass('dw_c_orange')
}
var filter_clicked_now;
function showFilterOther(id, obj) {
    $('#otherFilter li').removeClass('on');
    if (filter_clicked_now == obj) {
        $('.kel').hide();
        filter_clicked_now = null;
        return false;
    }
    $(obj).addClass('on');
    var objs = ['filter_p_issuedate', 'filter_p_jobterm', 'filter_p_keyword', 'filter_p_jobarea', 'filter_p_dibiaoid', 'filter_p_line'];
    if ($('#'+ id).is(':hidden')) {
        $.each(objs, function(i, n) {
            $('#'+ n).hide();
        });
        $('#'+ id).show();
    } else {
        $('#'+ id).hide();
    }
    $('.nk').hide();
    $('.kel').show();
    filter_clicked_now = obj;
}

function collapseExpansionSearch(DOMAIN_SEARCH, className, element) {
	var that = $(element);
    var element = $('.' + className);
    if (element.hasClass('on')) {  //收起
        that.find('span').html("展开更多选项<em class='dicon Dm'></em>");
        element.removeClass('on');
        collapseExpansion(DOMAIN_SEARCH, 9, 0);
        /* 收起其他筛选 */
        var objs = ['filter_p_issuedate', 'filter_p_jobterm', 'filter_p_keyword', 'filter_p_jobarea', 'filter_p_dibiaoid', 'filter_p_line'];
        $.each(objs, function(i, n) {
            $('#'+ n).hide();
        });
        $('.nk').hide();
		/*去除选项的style属性并隐藏多选*/
		$.each($(".dw_filter .el"),function(index,value){
			if(index % 2 == 0){
				$(this).removeAttr("style");
			}else{
				$(this).hide();
			}
		});
		
    } else {  //展开
        that.find('span').html("收起更多选项<em class='dicon Dm'></em>");
        element.addClass('on');
        collapseExpansion(DOMAIN_SEARCH, 10, 1);
    }
}

function selectAllJobs(element) {
    if ($(element).hasClass('on')) {
        $('#top_select_all_jobs_checkbox,#bottom_select_all_jobs_checkbox').removeClass('on');
        $("em[name='delivery_em']").removeClass("on");
        $("input[name='delivery_jobid']").attr("checked", false);
        $("div.op span.but_sq,div.op span.but_sc").addClass("uck");
    }
    else{
        $('#top_select_all_jobs_checkbox,#bottom_select_all_jobs_checkbox').addClass('on');
        $("em[name='delivery_em']").addClass("on");
        $("input[name='delivery_jobid']").attr("checked", true);
        $("div.op span.but_sq,div.op span.but_sc").removeClass("uck");
    }
}


function showStatistics(type) {
    var e = window.event || arguments.callee.caller.arguments[0]; // 获取event对象

    if ($('#' + type).is(':hidden')) {
        $('#' + type).show();

        $.each($('#' + type).parent().siblings(), function (index, value) {
            $(this).find('.intPopbox').hide();
        });
    } else {
        $('#' + type).hide();
    }

    if (e.stopPropagation) {
    // this code is for Mozilla and Opera
        e.stopPropagation();
    } else if (window.event) {
        // this code is for IE
        window.event.cancelBubble = true;
    }
}

function changeConfirmdate(id, value, defaultValue) {
    if ($('#' + id + '_checkbox').is(":checked")) {
        $('#' + id + '_checkbox').attr("checked", true);
        $('#' + id).val(value);
    } else {
        $('#' + id + '_checkbox').removeAttr("checked");
        $('#' + id).val(defaultValue);
    }


    zzSearch.formSub(zzSearch.searchForm);
}


function multipleChoiceShow(sType, bShow)
{
    if(bShow)
    {
		$("div[id^='filter_']").show();
        $('#filter_' + sType).hide();
        $("div[id^='multichoices_']").hide();
        $("#submit_" + sType).removeClass('unclick');
        $('#multichoices_' + sType).show();
        $("#multichoices_" + sType).find('div.err').hide();
    }
    else
    {
        $("div[id^='multichoices_']").hide();
        $('#multichoices_' + sType).find('li.on').removeClass('on');
        $('#multichoices_' + sType).find("li[name='defaultmultichoices']").addClass('on');
        $('#filter_' + sType).show();
    }
}


function checkMultipleChoice(oThis, sType)
{
    if($(oThis).hasClass('on'))
    {
        $("#multichoices_" + sType).find('div.err').hide();
        $(oThis).removeClass("on");
        if($("#multichoices_" + sType).find("li.on").length == 0)
        {
            $("#submit_" + sType).addClass('unclick');
            return;
        }
    }
    else
    {
        if($(oThis).attr('data-value') == '99')
        {
            $(oThis).siblings().removeClass("on");
            $(oThis).addClass('on');
        }
        else
        {
            $(oThis).siblings("li[data-value='99']").removeClass('on');
        }
        
        $("#submit_" + sType).removeClass('unclick');
        if($("#multichoices_" + sType).find("li.on").length >= 5)
        {
            $("#multichoices_" + sType).find('div.err').show();
            return;
        }
        else
        {
            $("#multichoices_" + sType).find('div.err').hide();
            $(oThis).addClass("on");
        }
    }
}

function submitMultiChoices(sType)
{
    if(!$("#submit_" + sType).hasClass("unclick"))
    {
        var aResult = [];
        $("#multichoices_" + sType).find("li.on").each(function(){
            aResult.push($(this).attr("data-value"));
        });
        
        if(aResult == []){
            sResult = '99';
        }
        else{
            sResult = aResult.join(",");
        }
        
        $('#' + sType).val(sResult);
        $(document.getElementsByName('pageForm')).submit();
    }
}

function jumpPage(totalPage)
{
    var jumpPage = parseInt($('#jump_page').val());

    if (jumpPage > 0 && jumpPage <= totalPage) {
        if (1 == jumpPage) {
            zzSearch.pageFormSub({curr_page: jumpPage}, true);
        } else {
            zzSearch.pageFormSub({curr_page: jumpPage}, false);
        }

    } else {
        alert('请输入正确的页码');
    }
}